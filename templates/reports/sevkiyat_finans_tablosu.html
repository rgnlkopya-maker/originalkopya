{% extends "base.html" %}
{% load static %}
{% load custom_tags %}

{% block extra_css %}
<style>

/* --- TABLO --- */
.table-modern {
    width: 100%;
    border-collapse: separate !important;
    border-spacing: 0 10px !important;
}
.table-modern thead th {
    background: #f5f7fb;
    color: #6b7280;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    padding: 14px 18px;
    padding-left: 22px !important;
    border: none !important;
    text-align: left !important;
}
.table-modern tbody tr {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    transition: all .15s ease;
}
.table-modern tbody tr:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.1);
}
.table-modern tbody td {
    padding: 16px 18px;
    font-size: 14px;
    border: none !important;
}
.table-modern tbody tr td:first-child {
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
}
.table-modern tbody tr td:last-child {
    border-top-right-radius: 12px;
    border-bottom-right-radius: 12px;
}

/* --- HEADER --- */
.modern-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #ffffffee;
    backdrop-filter: blur(12px);
    border-radius: 14px;
    padding: 14px 20px;
    margin: 22px 0;
    box-shadow: 0 4px 14px rgba(0,0,0,0.06);
}
.back-btn {
    font-size: 14px;
    background: #f3f4ff;
    padding: 6px 14px;
    border-radius: 8px;
    text-decoration: none;
    color: #3b45d9;
    font-weight: 600;
    border: 1px solid #dfe3ff;
}
.header-center { 
    display: flex; 
    gap: 12px; 
    flex-wrap: wrap; 
    justify-content: center;
}

.stat-badge {
    background: linear-gradient(to bottom right, #eef1ff, #dce2ff);
    padding: 8px 16px;
    border-radius: 10px;
    font-weight: 600;
    color: #2c2f48;
}

/* --- Search --- */
.search-area { display: flex; gap: 10px; align-items: center; }
.search-box {
    height: 42px;
    width: 260px;
    padding: 0 14px;
    border-radius: 22px;
    border: 1px solid #e6e9f2;
}

/* --- Link --- */
.order-link {
    font-weight: 700;
    color: #2f5bff;
    text-decoration: none;
}
.order-link:hover {
    text-decoration: underline;
}

/* --- Numeric --- */
.text-end { text-align: right !important; }

/* âœ… Kar renk */
.kar-positive { color: #16a34a; font-weight: 700; }
.kar-negative { color: #dc2626; font-weight: 700; }

/* --- ICON BUTTONS (ORDER LIST Ä°LE AYNI) --- */
.filter-btn {
    width: 42px;
    height: 42px;
    border-radius: 22px;
    border: 1px solid #e6e9f2;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 0;
}
.filter-btn i { 
    font-size: 20px; 
    color: #395bff; 
}
.filter-btn:hover { 
    background: #f4f6ff; 
    border-color: #cfd7ff; 
}

.filter-clear-btn {
    width: 42px;
    height: 42px;
    border-radius: 22px;
    border: 1px solid #e6e9f2;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    text-decoration: none;
}
.filter-clear-btn i { 
    font-size: 20px; 
    color: #ff4b4b; 
}
.filter-clear-btn:hover { 
    background: #fff1f1; 
    border-color: #ffcaca; 
}


</style>
{% endblock %}


{% block content %}
<div class="container-fluid px-2">

    <!-- HEADER -->
    <div class="modern-header">

    <!-- âœ… Ortadaki istatistikler -->
    <div class="header-center">
        <div class="stat-badge">ðŸ’° Ciro: {{ total_ciro|floatformat:2 }}</div>
        <div class="stat-badge">ðŸ“Œ Maliyet: {{ total_maliyet|floatformat:2 }}</div>
        <div class="stat-badge">âœ… KÃ¢r: {{ total_kar|floatformat:2 }}</div>
        <div class="stat-badge">ðŸ“Š %{{ kar_yuzde|floatformat:2 }}</div>
    </div>

    <!-- âœ… Tarih filtresi -->
    <form method="get" class="search-area">
        <input type="date"
               name="start"
               class="search-box"
               style="width:160px;"
               value="{{ start|default:'' }}">

        <input type="date"
               name="end"
               class="search-box"
               style="width:160px;"
               value="{{ end|default:'' }}">

        <button type="submit" class="filter-btn" title="Filtrele">
            <i class="bi bi-search"></i>
        </button>

        <a href="{% url 'sevkiyat_finans_tablosu' %}" class="filter-clear-btn" title="Temizle">
            <i class="bi bi-x-circle"></i>
        </a>
    </form>
</div>


    <!-- TABLE -->
    <div class="table-responsive shadow-sm rounded">
        <table class="table-modern" id="financeTable">
            <thead>
                <tr>
                    <th>SipariÅŸ No</th>
                    <th>MÃ¼ÅŸteri</th>
                    <th>ÃœrÃ¼n Kodu</th>
                    <th>MÃ¼ÅŸteri Ref</th>
                    <th>Adet</th>
                    <th>Renk</th>
                    <th>Beden</th>
                    <th>AÃ§Ä±klama</th>
                    <th>SevkedildiÄŸi Tarih</th>
                    <th class="text-end">SatÄ±ÅŸ</th>
                    <th class="text-end">Maliyet</th>
                    <th class="text-end">KÃ¢r</th>
                </tr>
            </thead>

            <tbody>
            {% for o in orders %}
                <tr>
                    <!-- âœ… SipariÅŸ No tÄ±klanabilir -->
                    <td>
                        <a class="order-link" href="{% url 'order_detail' o.id %}">
                            {{ o.siparis_numarasi }}
                        </a>
                    </td>

                    <td>{{ o.musteri.ad|default:"-" }}</td>
                    <td>{{ o.urun_kodu|default:"-" }}</td>
                    <td>{{ o.musteri_referans|default:"-" }}</td>
                    <td>{{ o.adet|default:"-" }}</td>
                    <td>{{ o.renk|default:"-" }}</td>
                    <td>{{ o.beden|default:"-" }}</td>
                    <td>{{ o.aciklama|default:"-" }}</td>

                    <!-- âœ… SevkedildiÄŸi Tarih -->
                    <td>
                        {% if o.last_status_date %}
                            {{ o.last_status_date|date:"d.m.Y" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    <td class="text-end">{{ o.satis_fiyati|default:"0" }}</td>
                    <td class="text-end">{{ o.toplam_maliyet_calc|default:"0" }}</td>

                    <td class="text-end">
                        {% if o.kar_calc < 0 %}
                            <span class="kar-negative">{{ o.kar_calc }}</span>
                        {% else %}
                            <span class="kar-positive">{{ o.kar_calc }}</span>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="12" class="text-center text-muted">Veri yok</td>
                </tr>
            {% endfor %}
            </tbody>

        </table>
    </div>

</div>
{% endblock %}


{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {

    // âœ… Search
    const searchInput = document.getElementById("searchInput");
    if (searchInput) {
        searchInput.addEventListener("keyup", function () {
            let v = this.value.toLowerCase();
            document.querySelectorAll("#financeTable tbody tr").forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(v) ? "" : "none";
            });
        });
    }

});
</script>
{% endblock %}
